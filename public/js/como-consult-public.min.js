!function(e){"use strict";var o=e("#virtual-consult");e(".modal-trigger a").click(function(){return e("#consultModal").modal("show"),!1}),e("#processing").addClass("hide"),e(".img-upload").on("change",function(o){var t=e(this).parent(".img-upload-wrap").children(".img-upload-preview"),n=e(this).parent(".img-upload-wrap").children(".img-path"),a=(e(this).parents(".formpage"),o.target.files[0]),s=o.target.name,i=new FormData;if(a.type.match("image.*")){e("#processing").removeClass("hide");ImageTools.resize(a,524288,function(o,l,c){if(l){i.append("file",o,a.name),i.append("fieldName",s);var d=new XMLHttpRequest;d.open("POST","/wp-content/plugins/como-consult/public/inc/imageUpload.php",!0),d.send(i),d.onload=function(){var o=JSON.parse(d.response);if(200===d.status&&"ok"===o.status){var a=o.fileName,s=(o.fieldName,"/wp-content/uploads/client-consult-photos/"+a);t.attr("src",s),t.fadeIn(500),n.val(s),e("#processing").addClass("hide")}else e("#processing").addClass("hide"),alert(c)}}})}else alert("Please choose an image file of type PNG or JPG.")}),e(document).on("click tap",".img-upload-preview",function(){e(this).parent(".img-upload-wrap").children(".img-upload").click()}),e(".phone-field").mask("(999) 999-9999");var t=o.validate({ignore:".ignore",errorClass:"warning",onkeyup:!1,onfocusout:!1});function n(o,t=!1){var n=o.parents(".formpage"),a=n.next(".formpage").not(".noShow"),s=a.attr("id");console.log("nextID"),console.log(s),e.when(n.addClass("hide-left")).done(function(){if(e("input","#"+s).removeClass("ignore"),!0===t){var o=a.height();e(".modal-body").css("height",o+150+"px"),a.css("height","auto").removeClass("hidden")}else a.css("height","auto").removeClass("hidden")})}function a(o,t){o[0].reset(),t&&(e(".modal-body .formpage").not(":first").addClass("hidden"),e(".modal-body .formpage:first").removeClass("hide-left"))}e(".modal-body .formpage:first").removeClass("hidden"),e("#consultModal").on("shown.bs.modal",function(){e(this).find(".modal-body").css({height:"auto","max-height":"100%"}),e("body").find(".cpcta-flyin").removeClass("slidOut"),e("body").find(".cpcta-flyin .cpcta-content-panel").css({display:"none"})}),e(".next-button").on("click",function(){t.form()&&n(e(this),!1)}),e("#consultModal .reset").on("click",function(){!0===confirm("WARNING: This will reset the consult form and you will need to start over.")&&(a(o,!0),e("#consultModal").modal("hide"))}),e("#consultModal .close-button").on("click",function(){a(o,!0),e("#consultModal").modal("hide")}),e("#virtual-consult").submit(function(t){t.preventDefault(),e("#processing").removeClass("hide");var s=e("#submitURL").val(),i=new FormData(this),l=e("#virtual-consult input[type=submit]");e(this).find("input[type=file]").each(function(){i.delete(e(this).attr("name"))}),e.ajax({type:"POST",url:s,data:i,dataType:"json",crossDomain:!1,async:!0,cache:!1,contentType:!1,processData:!1,timeout:1e4}).done(function(t){t.output?"messagesent"===t.output.response?e.when(e("#processing").addClass("hide")).done(function(){n(l,!0),a(o,!1)}):(e("#feedback").html("<p>"+t.output.feedback+"</p>"),setTimeout(function(){e("#processing").removeClass("hide")},3e3)):console.log("NO ACCOUNT")}).fail(function(e,o,t){console.log("ERROR");var n=JSON.parse(e.responseText);console.log(n.Message)})})}(jQuery);